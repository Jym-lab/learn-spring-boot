# π€ ν”„λ΅λ•μ… ν™κ²½ λ°°ν¬ μ¤€λΉ„ν•κΈ° (3)

## π§ λ¬΄μ—‡μ„ ν•λ”κ°€?
μ΄λ²μ—λ” ν”„λ΅λ•μ… ν™κ²½μ—μ„μ λ¨λ‹ν„°λ§μ— λ€ν•΄μ„ μ•μ•„λ³΄μ.

μ„λΉ„μ¤ μ¤‘μΈ μ• ν”λ¦¬μΌ€μ΄μ…μ λ°±κ·ΈλΌμ΄λ“λ¥Ό λ¨λ‹ν„°λ§ ν•  λ•

***Spring Boot Actuator***λ¥Ό μ‚¬μ©ν•λ©΄ λλ‹¤.

### π•ΉοΈ Spring Boot Actuator
Actuatorλ” Applicationμ„ λ¨λ‹ν„°λ§ν•κ³  κ΄€λ¦¬ν•  μ μλ” λ°μ΄ν„°λ¥Ό μ κ³µν•΄μ¤€λ‹¤.

Actuator λ””νλμ‹λ¥Ό build.gradleμ— μ¶”κ°€ν•΄μ£Όλ©΄ λλ‹¤.

![dependencies](img/dependencies.png)

κ° μ—”λ“ν¬μΈνΈλ΅ λ‹¤μ μ •λ³΄λ¥Ό ν™•μΈν•  μ μλ‹¤.
* π± **beans**
    * Applicationμ— ν¬ν•¨λ Spring beansλ¥Ό ν™•μΈν•  μ μλ‹¤.
* π’“ **health**
    * Applicationμ μƒνƒ μ •λ³΄λ¥Ό ν™•μΈν•  μ μλ‹¤.
* π“ **metrics**
    * Applicationκ³Ό κ΄€λ ¨λ μ—¬λ¬κ°€μ§€ metricsκ°€ μ κ³µλλ‹¤.
* π—ΊοΈ **mappings**
  * λ¨λ“  Request λ§¤ν•‘ κ΄€λ ¨ μ„Έλ¶€ μ‚¬ν•­μ„ ν™•μΈν•  μ μλ‹¤.

### π“ Metric
Metricμ€ μ„±λ¥μ„ μΈ΅μ •ν•κ³  λ¨λ‹ν„°λ§ν•λ” λ° μ‚¬μ©λλ” μμΉλ‚ λ°μ΄ν„°λ¥Ό μλ―Έν•λ‹¤.

μ‹κ°„μ— λ”°λ¥Έ μ¶”μ΄λ¥Ό μ¶”μ ν•  κ°€μΉκ°€ μλ” λ°μ΄ν„°λ¥Ό ***Metric***μ΄λΌκ³  λ¶€λ¥Έλ‹¤.

![λ§μ΄ν¬λ΅λ―Έν„°](img/micrometer.png)

Actuatorμ— λ‚΄μ¥λ MicroMeter λ¨λ“μ΄ λ©”νΈλ¦­ μμ§‘μ„ λ‹΄λ‹Ήν•κ³  μλ‹¤.

* π§  JVM λ©”λ¨λ¦¬ μ‚¬μ©λ‰
    * JVM(Java Virtual Machine)μ—μ„ μ‚¬μ©ν•λ” λ©”λ¨λ¦¬μ μ–‘μ„ ν™•μΈν•  μ μλ‹¤. μ΄λ¥Ό ν†µν•΄ λ©”λ¨λ¦¬ λ„μ λ“±μ λ¬Έμ λ¥Ό μ‹λ³„ν•  μ μλ‹¤.
* π—‘οΈ κ°€λΉ„μ§€ μ»¬λ ‰μ… νμ
    * κ°€λΉ„μ§€ μ»¬λ ‰μ…(Garbage Collection)μ΄ μ–Όλ§λ‚ μμ£Ό λ°μƒν•λ”μ§€λ¥Ό μ• μ μλ‹¤. μ΄λ” μ• ν”λ¦¬μΌ€μ΄μ…μ μ„±λ¥μ— μ¤‘μ”ν• μν–¥μ„ λ―ΈμΉλ‹¤.
* β±οΈ μ”μ²­ μμ™€ μ‘λ‹µ μ‹κ°„
    * μ• ν”λ¦¬μΌ€μ΄μ…μ— λ€ν• μ”μ²­ μμ™€ μ‘λ‹µ μ‹κ°„μ„ ν™•μΈν•¨μΌλ΅μ¨ νΈλν”½ ν¨ν„΄μ„ μ΄ν•΄ν•κ³  μ„±λ¥ λ¬Έμ λ¥Ό νμ•…ν•  μ μλ‹¤.
* π“΅ λ°μ΄ν„°λ² μ΄μ¤ μ—°κ²° μ
    * ν„μ¬ λ°μ΄ν„°λ² μ΄μ¤μ— μ—°κ²°λ μ„Έμ…μ μλ¥Ό ν™•μΈν•  μ μλ‹¤. μ΄λ” λ°μ΄ν„°λ² μ΄μ¤ μ„±λ¥μ— μ§μ ‘μ μΈ μν–¥μ„ λ―ΈμΉλ‹¤.

μ΄μ™€ κ°™μ€ Metrics μ •λ³΄λ¥Ό ν†µν•΄ μ• ν”λ¦¬μΌ€μ΄μ…μ μ„±λ¥μ„ μΈ΅μ •ν•κ³ ,

λ¬Έμ κ°€ λ°μƒν–μ„ λ• μ‹ μ†ν•κ² λ€μ‘ν•  μ μλ‹¤.

### π› οΈ μ‚¬μ© λ°©λ²•

μ„λ²„λ¥Ό μ‹¤ν–‰ν•κ³  [localhost:8080/actuator](http://localhost:8080/actuator)μ— μ ‘μ†ν•΄λ³΄μ

![actuator_endpoint.png](img/actuator_endpoint.png)

μ΄μ™€ κ°™μ€ ν™”λ©΄μ΄ λ‚μ¨λ‹¤.

λ§¨ λ§μ§€λ§‰μ health λ§ν¬λ¥Ό ν΄λ¦­ν•΄λ³΄μ.

![health](img/health.png)

μ• ν”λ¦¬μΌ€μ΄μ…μ μƒνƒλ” ν„μ¬ 'UP'μ΄λΌκ³  ν‘μ‹λλ”λ° μ‹¤ν–‰ μ¤‘μ„μ„ λ»ν•λ‹¤.

### π¤” κ·Όλ° μ„μ—μ„ μ„¤λ…ν• κ²ƒλ“¤μ€ λ‹¤ μ–΄λ”¨μ–΄μ”?
κΈ°λ³Έ μ μΌλ΅ Actuatorλ” health μ—”λ“ν¬μΈνΈλ§ λ…Έμ¶ν•λ‹¤.

μ„μ—μ„ μ„¤λ…ν• κ²ƒμ²λΌ λ” λ§μ€ κΈ°λ¥μ„ μ‚¬μ©ν•λ ¤λ©΄

λ‹¤μμ„ application.propertiesμ— μ¶”κ°€ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤.

```markdown
management.endpoints.web.exposure.include=*
```
![include](img/include.png)

μ΄λ ‡κ² ν•λ©΄ Actuatorμ—μ„ μ κ³µν•λ” λ¨λ“  μ—”λ“ν¬μΈνΈκ°€ λ…Έμ¶λλ‹¤.

<p align="center" style="font-style: italic; color:gray">
    <img src="img/endpointsall.png" alt="endpointsall"><br>
    π—‚οΈ λ„λ¬΄ λ§μ•„μ„ μƒλµν–μ§€λ§ μ •λ§ λ§λ‹¤.
</p>

μ—¬κΈ°μ— ν‘μ‹λ λ¨λ‘λ¥Ό μ• ν•„μ”λ” μ—†κ³ , μ¤‘μ”ν• λ‡ κ°€μ§€λ§ μ•λ©΄ λλ‹¤.

#### 1οΈβƒ£. Beans<

![beans](img/beans.png)

λ‚΄κ°€ λ§λ“  courseControllerμ— λ€ν• bean

μ΄ μ™Έμ—λ„ μ¤ν”„λ§ ν”„λ μ„μ›ν¬μ—μ„ μ‚¬μ©ν•λ” λ‹¤μ–‘ν• bean ν‘μ‹λλ‹¤.

νΉμ • ν•­λ©μ΄ μλ™ μ„¤μ • λμ—λ”μ§€ μ•„λ‹μ§€λ¥Ό ν™•μΈν•  λ• μ‚¬μ©ν•  μμλ‹¤.

[localhost:8080/actuator/beans](http://localhost:8080/actuator/beans)

#### 2οΈβƒ£. configprops

μ—΄μ–΄λ³΄λ©΄ application.propertiesμ—μ„ μ„¤μ •ν•  μ μλ” λ¨λ“  ν•­λ©μ΄ ν‘μ‹λλ‹¤.

![configprops](img/configprops.png)

μ•μ„ λ§λ“¤μ—λ CurrentServiceConfigurationλ„ ν‘μ‹λλ‹¤.

> value λ¶€λ¶„μ΄ μ•”νΈν™” λ κ²½μ° application.propertiesμ— λ‹¤μμ„ μ¶”κ°€ν•λ©΄ λλ‹¤.
> `management.endpoint.configprops.show-values=ALWAYS`

[localhost:8080/actuator/configprops](http://localhost:8080/actuator/configprops)

#### 3οΈβƒ£. env

env μ—”λ“ν¬μΈνΈλ” ν™κ²½μ— κ΄€ν• μ„Έλ¶€ μ‚¬ν•­μ„ λ¨λ‘ ν‘μ‹ν•λ‹¤.

![env](img/env.png)

ν™μ„±ν™” λ ν”„λ΅νμΌ, μ„λ²„ ν¬νΈ, μ‚¬μ©ν•λ” μλ°” λ²„μ „ λ“±λ“±μ΄ ν‘μ‹λλ‹¤.

> value λ¶€λ¶„μ΄ μ•”νΈν™” λ κ²½μ° application.propertiesμ— λ‹¤μμ„ μ¶”κ°€ν•λ©΄ λλ‹¤.
> `management.endpoint.env.show-values=ALWAYS`

[localhost:8080/actuator/env](http://localhost:8080/actuator/env)

#### 4οΈβƒ£. metrics

λ§μ§€λ§‰μΌλ΅ μ‚΄ν΄λ³Ό κ±΄ metrics

μ—¬λ¬κ°€μ§€μ— λ€ν• λ©λ΅μ΄ λ‚μ¨λ‹¤.

![metrics](img/metrics.png)

μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘ μ‹κ°„, λ””μ¤ν¬ μ—¬μ  κ³µκ°„, μ΄ κ³µκ°„μ΄λ‚ JVM κ΄€λ ¨ λ‚΄μ©λ“¤μ΄ λ‚μ¨λ‹¤.

μ΄ μ¤‘ http.server.requestsλ¥Ό μ‚΄ν΄λ³΄μ

[localhost:8080/actuator/metrics/http.server.requests](http://localhost:8080/actuator/metrics/http.server.requests)

![requests](img/requests.png)

1. μ„λ²„ μ”μ²­ νμλ” 13ν
2. μ”μ²­μ„ μ²λ¦¬ν•λ” μ΄ μ‹¤ν–‰ μ‹κ°„ 0.26μ΄
3. νΉμ • μ”μ²­μ„ μ²λ¦¬ν•λ” μµλ€ μ‹κ°„μ€ 0.020μ΄

λΌκ³  ν‘μ‹λμ–΄ μλ‹¤. νμ΄μ§€λ¥Ό μƒλ΅κ³ μΉ¨ ν•λ©΄ νμκ°€ μ μ  λμ–΄λ‚λ‹¤.

[localhost:8080/actuator/metrics](http://localhost:8080/actuator/metrics)

### π¤” μ–΄λ–»κ² μ‚¬μ©ν•λ”κ² μΆ‹μ„κΉ?
λ¨Όμ € Actuatorμ„ μ‚¬μ©ν•  λ• κΈ°μ–µν•΄μ•Ό ν•  κ°€μ¥ μ¤‘μ”ν• ν• κ°€μ§€λ”

μ—¬λ¬ μ—”λ“ν¬μΈνΈλ¥Ό μ‚¬μ© μ„¤μ •ν•λ©΄ ν•΄λ‹Ή μ •λ³΄λ¥Ό μμ§‘ν•κ² λκ³ ,

λ§μ€ μ •λ³΄λ¥Ό μμ§‘ν•κ² λλ©΄ CPUμ™€ λ©”λ¨λ¦¬κ°€ λ§μ΄ μ‚¬μ©λλ‹¤.

λ”°λΌμ„ μ—”λ“ν¬μΈνΈλ¥Ό μ„¤μ •ν•  λ• λ‹¤μκ³Ό κ°™μ΄ λ…μ‹μ μΌλ΅ μ„ μ–Έν•λ” κ²ƒμ΄ μΆ‹λ‹¤.

```markdown
management.endpoints.web.exposure.include=health,metrics
```

μ΄ μ μ„ κΈ°μ–µν•λ©΄μ„ ν•„μ”ν• λ¶€λ¶„λ§ μ μ¬μ μ†μ— ν™μ©ν•  μ μλ„λ΅ μ‚¬μ©ν•΄λ³΄μ
